<!doctype html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PMSAuto 管理后台</title>
  <link rel="stylesheet" href="/app/styles.css">
</head>
<body>
  <div class="container admin">
    <div class="hero-card" style="margin-top:0">
      <h2>管理中心</h2>
      <p>系统管理与配置</p>
    </div>

    <div class="card" style="margin-top:10px;">
      <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
        <button class="tab small active" data-admin-tab="overview">概览</button>
        <button class="tab small" data-admin-tab="settings">系统设置项</button>
        <button class="tab small" data-admin-tab="activity">活动管理</button>
        <div style="margin-left:auto; max-width:340px; flex:1; min-width:220px;">
          <label for="token" style="font-size:12px; color:#64748b;">管理员 Token（不会持久化，仅本页内存使用）</label>
          <input id="token" type="password" placeholder="输入 EMBY_ADMIN_TOKEN" style="width:100%" />
        </div>
      </div>
    </div>

    <!-- 概览 -->
    <section id="admin-overview" class="page active">
      <div class="card">
        <div class="card-title with-icon"><span class="icon">👥</span><span>用户统计</span></div>
        <div class="kv" style="text-align:center;">
          <div><span class="k">PLEX 用户</span><span class="v" id="stat-plex" style="font-size:28px; color:#f59e0b;">-</span></div>
          <div><span class="k">EMBY 用户</span><span class="v" id="stat-emby" style="font-size:28px; color:#16a34a;">-</span></div>
          <div><span class="k">总用户数</span><span class="v" id="stat-total" style="font-size:28px; color:#2563eb;">-</span></div>
        </div>
      </div>
      <pre id="log"></pre>
    </section>

    <!-- 系统设置项 -->
    <section id="admin-settings" class="page">
      <div class="card">
        <div style="margin-bottom:8px;">当前默认初始天数：<b id="current">-</b></div>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
          <label style="display:flex; align-items:center; gap:6px;">
            <input id="days-enable" type="checkbox" checked /> 启用默认注册时长
          </label>
          <input id="days" type="number" min="0" max="3650" placeholder="新的默认天数，例如 180" />
          <button id="preset-30">30天</button>
          <button id="preset-60">60天</button>
          <button id="preset-90">90天</button>
          <button id="btn-load">读取</button>
          <button id="btn-save">保存</button>
        </div>
        <small>关闭“启用默认注册时长”将把默认值设为 0（即注册/绑定时不设置到期时间）。</small>
      </div>

      <div class="card">
        <h3>捐赠管理</h3>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
          <input id="don-uid" placeholder="emby_user_id" style="flex:2" />
          <button id="don-load">读取捐赠</button>
        </div>
        <div style="display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap;">
          <input id="don-set" type="number" placeholder="设置捐赠总额（整数）" />
          <button id="don-save">保存设置</button>
          <input id="don-add" type="number" placeholder="增量（可正可负）" />
          <button id="don-apply">增量调整</button>
        </div>
        <div>当前捐赠金额：<b id="don-cur">-</b></div>
      </div>

      <div class="card">
        <h3>观看时长管理</h3>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
          <input id="wat-uid" placeholder="emby_user_id" style="flex:2" />
          <button id="wat-load">读取时长</button>
        </div>
        <div style="display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap;">
          <input id="wat-set" type="number" placeholder="设置总秒数（非负整数）" />
          <button id="wat-save">保存设置</button>
          <input id="wat-add" type="number" placeholder="增量秒数（可正可负）" />
          <button id="wat-apply">增量调整</button>
        </div>
        <div>当前累计秒数：<b id="wat-cur">-</b>（积分贡献 = 秒数/1800）</div>
      </div>
    </section>

    <!-- 活动管理 -->
    <section id="admin-activity" class="page">
      <div class="card">
        <h3>幸运大转盘配置</h3>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px;">
          <button id="wheel-load">读取配置</button>
          <button id="wheel-save">保存配置</button>
          <small>读取无需 Token，保存需要管理员 Token</small>
        </div>
        <textarea id="wheel-json" style="width:100%; min-height:220px; font-family: ui-monospace, SFMono-Regular, Menlo, monospace;" placeholder='{"min_points":30,"cost_points":5,"items":[{"label":"积分+10","color":"#60a5fa","weight":1}]}'></textarea>
      </div>
    </section>

  <script src="/app/admin.js?v=20250916-01"></script>
</body>
</html>
